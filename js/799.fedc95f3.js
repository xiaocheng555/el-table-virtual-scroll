(self["webpackChunkel_table_virtual_scroll"]=self["webpackChunkel_table_virtual_scroll"]||[]).push([[799],{802:function(t,e,i){var l=i(1990),s=l.Symbol;t.exports=s},6251:function(t,e,i){var l=i(802),s=i(3845),n=i(7760),o="[object Null]",r="[object Undefined]",a=l?l.toStringTag:void 0;function c(t){return null==t?void 0===t?r:o:a&&a in Object(t)?s(t):n(t)}t.exports=c},3349:function(t,e,i){var l=i(3676),s=/^\s+/;function n(t){return t?t.slice(0,l(t)+1).replace(s,""):t}t.exports=n},8371:function(t,e,i){var l="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;t.exports=l},3845:function(t,e,i){var l=i(802),s=Object.prototype,n=s.hasOwnProperty,o=s.toString,r=l?l.toStringTag:void 0;function a(t){var e=n.call(t,r),i=t[r];try{t[r]=void 0;var l=!0}catch(a){}var s=o.call(t);return l&&(e?t[r]=i:delete t[r]),s}t.exports=a},7760:function(t){var e=Object.prototype,i=e.toString;function l(t){return i.call(t)}t.exports=l},1990:function(t,e,i){var l=i(8371),s="object"==typeof self&&self&&self.Object===Object&&self,n=l||s||Function("return this")();t.exports=n},3676:function(t){var e=/\s/;function i(t){var i=t.length;while(i--&&e.test(t.charAt(i)));return i}t.exports=i},8530:function(t,e,i){i(1703);var l=i(359),s=i(9263),n=i(7044),o="Expected a function",r=Math.max,a=Math.min;function c(t,e,i){var c,h,d,u,f,p,m=0,v=!1,w=!1,g=!0;if("function"!=typeof t)throw new TypeError(o);function x(e){var i=c,l=h;return c=h=void 0,m=e,u=t.apply(l,i),u}function b(t){return m=t,f=setTimeout(S,e),v?x(t):u}function y(t){var i=t-p,l=t-m,s=e-i;return w?a(s,d-l):s}function _(t){var i=t-p,l=t-m;return void 0===p||i>=e||i<0||w&&l>=d}function S(){var t=s();if(_(t))return $(t);f=setTimeout(S,y(t))}function $(t){return f=void 0,g&&c?x(t):(c=h=void 0,u)}function T(){void 0!==f&&clearTimeout(f),m=0,c=p=h=f=void 0}function k(){return void 0===f?u:$(s())}function C(){var t=s(),i=_(t);if(c=arguments,h=this,p=t,i){if(void 0===f)return b(p);if(w)return clearTimeout(f),f=setTimeout(S,e),x(p)}return void 0===f&&(f=setTimeout(S,e)),u}return e=n(e)||0,l(i)&&(v=!!i.leading,w="maxWait"in i,d=w?r(n(i.maxWait)||0,e):d,g="trailing"in i?!!i.trailing:g),C.cancel=T,C.flush=k,C}t.exports=c},359:function(t){function e(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=e},6841:function(t){function e(t){return null!=t&&"object"==typeof t}t.exports=e},6619:function(t,e,i){var l=i(6251),s=i(6841),n="[object Symbol]";function o(t){return"symbol"==typeof t||s(t)&&l(t)==n}t.exports=o},9263:function(t,e,i){var l=i(1990),s=function(){return l.Date.now()};t.exports=s},1953:function(t,e,i){i(1703);var l=i(8530),s=i(359),n="Expected a function";function o(t,e,i){var o=!0,r=!0;if("function"!=typeof t)throw new TypeError(n);return s(i)&&(o="leading"in i?!!i.leading:o,r="trailing"in i?!!i.trailing:r),l(t,e,{leading:o,maxWait:e,trailing:r})}t.exports=o},7044:function(t,e,i){var l=i(3349),s=i(359),n=i(6619),o=NaN,r=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt;function d(t){if("number"==typeof t)return t;if(n(t))return o;if(s(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=s(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=l(t);var i=a.test(t);return i||c.test(t)?h(t.slice(2),i?2:8):r.test(t)?o:+t}t.exports=d},7799:function(t,e,i){"use strict";i.d(e,{Fg:function(){return k},ZP:function(){return C}});var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"el-table-virtual-scroll",class:[t.isExpanding?"is-expanding":"",t.isHideAppend?"hide-append":"",t.scrollPosition?`is-scrolling-${t.scrollPosition}`:""]},[t._t("default",null,null,{cellFixedStyle:t.cellFixedStyle})],2)},s=[],n=(i(1703),i(1953)),o=i.n(n);function r(t){const e=window.getComputedStyle(t,null),i=["auto","scroll"];return i.includes(e.overflow)||i.includes(e["overflow-y"])}function a(t){let e=t;while(e){if([window,document,document.documentElement].includes(e))return window;if(r(e))return e;e=e.parentNode}return e||window}function c(t){return t===window?window.pageYOffset:t.scrollTop}function h(t){return t===window?window.innerHeight:t.offsetHeight}function d(t,e){t===window?window.scroll(0,e):t.scrollTop=e}function u(t){return"undefined"===typeof t||null===t}const f=[".el-table__body-wrapper",".el-table__fixed-right .el-table__fixed-body-wrapper",".el-table__fixed .el-table__fixed-body-wrapper"];let p=0;var m={name:"el-table-virtual-scroll",props:{data:{type:Array,required:!0},itemSize:{type:Number,default:60},scrollBox:{type:String},buffer:{type:Number,default:200},keyProp:{type:String,default:"id"},throttleTime:{type:Number,default:10},dynamic:{type:Boolean,default:!0},virtualized:{type:Boolean,default:!0},rowSpanKey:{type:Function},clearFixedMapTime:{type:Number,default:2e3}},provide(){return{virtualScroll:this}},data(){return{sizes:{},start:0,end:void 0,curRow:null,isExpanding:!1,columnVms:[],isHideAppend:!1,scrollPosition:""}},computed:{offsetMap({keyProp:t,itemSize:e,sizes:i,data:l}){if(!this.dynamic)return{};const s={};let n=0;for(let o=0;o<l.length;o++){const r=l[o][t];"undefined"===typeof r&&console.warn(`data[${o}][${t}] 为 undefined，请确保 keyProp 对应的值不为undefined`),s[r]=n;const a=i[r],c="number"===typeof a?a:e;n+=c}return s}},methods:{initData(){if(this.renderData=[],this.top=void 0,this.bottom=void 0,this.start=0,this.end=void 0,this.isInnerScroll=!1,this.toTop=0,this.elTable=this.$children[0],!this.elTable||"ElTable"!==this.elTable.$options.name)throw new Error("el-table-virtual-column 组件插槽内必须是el-table");this.scroller=this.getScroller(),this.setToTop(),this.observeScrollPosition(),setTimeout((()=>{this.handleScroll()}),100),this.onScroll=this.throttleTime?o()(this.handleScroll,this.throttleTime):this.handleScroll,this.scroller.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onScroll),this.bindTableExpandEvent()},getScroller(){let t;if(this.scrollBox){if("window"===this.scrollBox||this.scrollBox===window)return window;if(t=document.querySelector(this.scrollBox),!t)throw new Error(` scrollBox prop: '${this.scrollBox}' is not a valid selector`);return r(t)||console.warn(`Warning! scrollBox prop: '${this.scrollBox}' is not a scroll element`),t}return this.elTable&&(this.elTable.height||this.elTable.maxHeight)?(this.isInnerScroll=!0,this.$el.querySelector(".el-table__body-wrapper")):a(this.$el)},setToTop(){this.isInnerScroll?this.toTop=0:this.toTop=this.$el.getBoundingClientRect().top-(this.scroller===window?0:this.scroller.getBoundingClientRect().top)+c(this.scroller)},observeScrollPosition(){this.scrollUnWatch=this.$watch((()=>this.elTable.scrollPosition),(t=>{this.scrollPosition=t}),{immediate:!0})},handleScroll(t=!0){this.virtualized&&(this.removeHoverRows(),this.updateSizes(),this.calcRenderData(),this.calcPosition(),t&&this.updatePosition(),this.$emit("change",this.renderData,this.start,this.end),this.setRowsExpanded())},removeHoverRows(){const t=this.$el.querySelectorAll(".el-table__row.hover-row");t.length>1&&Array.from(t).forEach((t=>{t.classList.remove("hover-row")}))},updateSizes(){if(!this.dynamic)return;let t=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row"),e=!1;t[0]&&t[0].classList.contains("el-table__row--level-0")&&(e=!0,t=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row.el-table__row--level-0")),Array.from(t).forEach(((t,i)=>{const l=this.renderData[i];if(!l)return;let s=t.offsetHeight;if(t.classList.contains("expanded")&&(s+=t.nextSibling.offsetHeight),e){let e=t.nextSibling;while(e&&"TR"===e.tagName&&!e.classList.contains("el-table__row--level-0"))s+=e.offsetHeight,e=e.nextSibling}const n=l[this.keyProp];this.sizes[n]!==s&&this.$set(this.sizes,n,s)}))},getItemOffsetTop(t){if(!this.dynamic)return this.itemSize*t;const e=this.data[t];return e&&this.offsetMap[e[this.keyProp]]||0},getItemSize(t){if(t<=-1)return 0;const e=this.data[t];if(e){const t=e[this.keyProp];return this.sizes[t]||this.itemSize}return this.itemSize},calcRenderData(){const{scroller:t,data:e,buffer:i}=this,l=c(t)-i-this.toTop,s=c(t)+h(t)+i-this.toTop;let n,o;if(this.dynamic){let t=0,i=e.length-1,r=0;while(t<=i){r=Math.floor((t+i)/2);const e=this.getItemOffsetTop(r);if(e<l){const e=this.getItemOffsetTop(r+1);if(e>l)break;t=r+1}else i=r-1}n=r,o=e.length-1;for(let l=n+1;l<e.length;l++){const t=this.getItemOffsetTop(l);if(t>=s){o=l;break}}}else n=l<=0?0:Math.floor(l/this.itemSize),o=s<=0?0:Math.ceil(s/this.itemSize);this.isRowSpan()?[n,o]=this.calcRenderSpanData(n,o):n%2&&(n-=1),this.top=l,this.bottom=s,this.start=n,this.end=o,this.renderData=e.slice(n,o+1)},isRowSpan(){return"function"===typeof this.rowSpanKey},calcRenderSpanData(t,e){let i;while(t>0){const e=this.data[t],l=this.rowSpanKey(e,t);if(u(l))break;if(!u(i)&&i!==l){t++;break}i=l,t--}const l=this.data.length;i=void 0;while(e<l){const t=this.data[e],l=this.rowSpanKey(t,e);if(!l)break;if(i&&i!==l){e--;break}i=l,e++}return[t,e]},calcPosition(){const t=this.data.length-1,e=this.getItemOffsetTop(t)+this.getItemSize(t),i=this.getItemOffsetTop(this.start);f.forEach((t=>{const l=this.$el.querySelector(t);if(l){if(!l.wrapEl){const t=document.createElement("div"),e=document.createElement("div");t.appendChild(e),e.appendChild(l.children[0]),l.insertBefore(t,l.firstChild),l.wrapEl=t,l.innerEl=e}l.wrapEl&&(l.wrapEl.style.height=e+"px",l.innerEl.style.transform=`translateY(${i}px)`)}}))},updatePosition(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.timer&&clearTimeout(this.timer),this.handleScroll(!1)}),this.throttleTime+10)},renderAllData(){this.renderData=this.data,this.$emit("change",this.data,0,this.data.length-1),this.$nextTick((()=>{f.forEach((t=>{const e=this.$el.querySelector(t);e&&e.wrapEl&&(e.wrapEl.style.height="auto",e.innerEl.style.transform="translateY(0px)")}))}))},update(){this.setToTop(),this.handleScroll()},scrollTo(t,e=!1){const i=this.data[t];i&&this.scroller&&(this.updateSizes(),this.calcRenderData(),this.$nextTick((()=>{const i=this.getItemOffsetTop(t);d(this.scroller,i),e||setTimeout((()=>{this.scrollTo(t,!0)}),50)})))},reset(){this.sizes={},this.scrollTo(0,!1)},addColumn(t){this.columnVms.push(t)},removeColumn(t){this.columnVms=this.columnVms.filter((e=>e!==t))},checkAll(t){const e=[];this.data.forEach((i=>{i.$v_checked&&e.push(i),this.checkRow(i,t,!1)})),this.emitSelectionChange(e),!1===t&&(p=0)},checkRow(t,e,i=!0){t.$v_checked!==e&&(this.$set(t,"$v_checked",e),this.$set(t,"$v_checkedOrder",e?p++:void 0),i&&this.emitSelectionChange(e?[]:[t]))},emitSelectionChange(t){const e=this.data.filter((t=>t.$v_checked)).sort(((t,e)=>t.$v_checkedOrder-e.$v_checkedOrder));this.$emit("selection-change",e,t)},clearSelection(){this.checkAll(!1),this.columnVms.forEach((t=>t.syncCheckStatus()))},toggleRowSelection(t,e){const i="boolean"===typeof e?e:!t.$v_checked;this.checkRow(t,i),this.columnVms.forEach((t=>t.syncCheckStatus()))},bindTableExpandEvent(){this.isExpandType&&this.elTable.$on("expand-change",((t,e)=>{this.$set(t,"$v_expanded",e.includes(t))}))},setRowsExpanded(){this.isExpandType&&this.$nextTick((()=>{const t=this.renderData.filter((t=>t.$v_expanded));0!==t.length&&(t.forEach((t=>{this.elTable.toggleRowExpansion(t,!0)})),this.isExpanding=!0,setTimeout((()=>{this.isExpanding=!1}),10))}))},toggleRowExpansion(t,e){const i="boolean"===typeof e;this.$set(t,"$v_expanded",i?e:!t.$v_expanded),this.renderData.includes(t)&&this.elTable.toggleRowExpansion(t,e)},setCurrentRow(t){this.curRow=t,this.$emit("current-change",t)},updateData(t){this.$emit("update:data",t)},doUpdate(){this.hasDoUpdate||this.scroller&&(this.isHideAppend=!0,this.update(),this.hasDoUpdate=!0,this.$nextTick((()=>{this.hasDoUpdate=!1,this.isHideAppend=!1})))},cellFixedStyle({column:t}){const e=this.$children[0];if(e){if(!this.fixedMap){this.fixedMap={},this.totalLeft=0,this.totalRight=0,setTimeout((()=>{this.fixedMap=null}),this.clearFixedMapTime);const t=e.columns,i=[];let l,s;for(let e=0;e<t.length;e++){const n=t[e],o=n.className&&n.className.includes("virtual-column__fixed-left"),r=n.className&&n.className.includes("virtual-column__fixed-right");(o||r)&&(o&&(l=n,this.fixedMap[n.id]={left:this.totalLeft+"px"},this.totalLeft+=n.realWidth||n.width),r&&(s||(s=n),i.push(n)))}const n=" is-last-column",o=" is-first-column";l&&!l.className.includes(n)&&(l.className+=n),s&&!s.className.includes(o)&&(s.className+=o),i.reverse().forEach((t=>{this.fixedMap[t.id]={right:this.totalRight+"px"},this.totalRight+=t.realWidth}))}return this.fixedMap[t.id]}}},watch:{data(){this.virtualized?this.doUpdate():this.renderAllData(),this.columnVms.forEach((t=>t.syncCheckStatus()))},virtualized:{immediate:!0,handler(t){t?this.doUpdate():this.renderAllData()}}},created(){this.$nextTick((()=>{this.initData()}))},beforeDestroy(){this.scroller&&(this.scroller.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onScroll)),this.scrollUnWatch&&this.scrollUnWatch()}},v=m,w=i(1001),g=(0,w.Z)(v,l,s,!1,null,"32c822d4",null),x=g.exports,b=function(){var t=this,e=t._self._c;return e("el-table-column",t._g(t._b({attrs:{"class-name":t.getClassName},scopedSlots:t._u([{key:"header",fn:function(i){return[t.$scopedSlots["header"]?t._t("header",null,null,i):["v-selection"===i.column.type?e("el-checkbox",{attrs:{indeterminate:t.isCheckedImn},on:{change:t.onCheckAllRows},model:{value:t.isCheckedAll,callback:function(e){t.isCheckedAll=e},expression:"isCheckedAll"}}):[t._v(" "+t._s(i.column.label)+" ")]]]}},{key:"default",fn:function(i){return[i.column&&"v-tree"===i.column.type?[e("span",{staticClass:"el-table__indent",style:{paddingLeft:(i.row.$level-1)*t.indent+"px"}}),!1!==i.row.$v_hasChildren?e("div",{staticClass:"el-table__expand-icon",class:i.row.$v_expanded?"el-table__expand-icon--expanded":"",on:{click:function(e){return t.onTreeNodeExpand(i.row)}}},[i.row.$v_loading?e("i",{staticClass:"el-icon-loading"}):e("i",{staticClass:"el-icon-arrow-right"})]):e("span",{staticClass:"el-table__placeholder"})]:t._e(),t.$scopedSlots["default"]?t._t("default",null,null,i):["v-selection"===i.column.type?e("el-checkbox",{attrs:{value:i.row.$v_checked},on:{change:function(e){return t.onCheckRow(i.row,!i.row.$v_checked)}}}):t._e(),"v-radio"===i.column.type?e("el-radio",{attrs:{label:!0,value:t.virtualScroll.curRow===i.row},on:{change:function(e){return t.onRadioChange(i.row)}}},[e("span")]):"v-index"===i.column.type?e("span",[t._v(" "+t._s(t.getIndex(i))+" ")]):[t._v(" "+t._s(i.row[i.column.property])+" ")]]]}}],null,!0)},"el-table-column",t.$attrs,!1),t.$listeners))},y=[],_=i(5114),S={name:"el-table-virtual-column",components:{ElTableColumn:_.TableColumn,ElCheckbox:_.Checkbox,ElRadio:_.Radio},inject:["virtualScroll"],props:{load:{type:Function},indent:{type:Number,default:16}},data(){return{isCheckedAll:!1,isCheckedImn:!1,isTree:!1}},computed:{getClassName(){const t=[],e=this.$attrs["class-name"]||this.$attrs.className;e&&t.push(e),this.isTree&&t.push("el-table__row--level");let i=this.$attrs.vfixed;return!0!==i&&""!==i||(i="left"),i&&t.push("virtual-column__fixed-"+i),t.join(" ")}},methods:{onCheckAllRows(t){t=!!this.isCheckedImn||t,this.virtualScroll.checkAll(t),this.isCheckedAll=t,this.isCheckedImn=!1},onCheckRow(t,e){this.virtualScroll.checkRow(t,e),this.syncCheckStatus()},syncCheckStatus(){const t=this.virtualScroll.data,e=t.filter((t=>!0===t.$v_checked)).length;0===e?(this.isCheckedAll=!1,this.isCheckedImn=!1):e===t.length?(this.isCheckedAll=!0,this.isCheckedImn=!1):(this.isCheckedAll=!1,this.isCheckedImn=!0)},onRadioChange(t){this.virtualScroll.setCurrentRow(t)},getIndex(t){const e=this.virtualScroll.start+t.$index;return"function"===typeof this.$attrs.index?this.$attrs.index(e):e+1},onTreeNodeExpand(t){this.$set(t,"$v_expanded",!t.$v_expanded),t.$v_expanded?this.loadChildNodes(t):this.hideChildNodes(t)},loadChildNodes(t){if(t.$v_loaded){const e=this.virtualScroll.data,i=e.findIndex((e=>e===t));i>-1&&this.virtualScroll.updateData([...e.slice(0,i+1),...t.$v_hideNodes,...e.slice(i+1)])}else this.$set(t,"$v_loading",!0),this.load&&this.load(t,e.bind(this));function e(e){Array.isArray(!e)&&(e=[]),this.$set(t,"$v_loading",!1),this.$set(t,"$v_loaded",!0),this.$set(t,"$v_hasChildren",!!e.length),e.forEach((e=>{e.$level="number"===typeof t.$level?t.$level+1:2}));const i=this.virtualScroll.data,l=i.findIndex((e=>e===t));l>-1&&this.virtualScroll.updateData([...i.slice(0,l+1),...e,...i.slice(l+1)])}},hideChildNodes(t){const e=this.virtualScroll.data,i=e.findIndex((e=>e===t));if(-1===i)return;const l=[];for(let n=i+1;n<e.length;n++){const i=e[n];if((i.$level||1)<=(t.$level||1))break;l.push(i)}this.$set(t,"$v_hideNodes",l);const s=e.filter((t=>!l.includes(t)));this.virtualScroll.updateData(s),this.virtualScroll.update()}},beforeCreate(){const{type:t}=this.$attrs;["index","selection","radio","tree"].includes(t)&&(this.$attrs.type="v-"+t)},created(){this.virtualScroll.addColumn(this);const{type:t}=this.$attrs;"expand"===t?this.virtualScroll.isExpandType=!0:"v-tree"===t&&(this.isTree=!0)},beforeDestroy(){this.virtualScroll.removeColumn(this)}},$=S,T=(0,w.Z)($,b,y,!1,null,null,null),k=T.exports,C=x}}]);
//# sourceMappingURL=799.fedc95f3.js.map