import{c as _,g as le,V as Se,n as ve}from"./index-b4RXg8tS.js";function we(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var L=we,xe=typeof _=="object"&&_&&_.Object===Object&&_,$e=xe,Ee=$e,_e=typeof self=="object"&&self&&self.Object===Object&&self,ke=Ee||_e||Function("return this")(),oe=ke,Re=oe,Ce=function(){return Re.Date.now()},De=Ce,Oe=/\s/;function Pe(e){for(var t=e.length;t--&&Oe.test(e.charAt(t)););return t}var Ae=Pe,Fe=Ae,Me=/^\s+/;function Ne(e){return e&&e.slice(0,Fe(e)+1).replace(Me,"")}var We=Ne,He=oe,Ie=He.Symbol,ae=Ie,B=ae,he=Object.prototype,je=he.hasOwnProperty,Ve=he.toString,$=B?B.toStringTag:void 0;function Le(e){var t=je.call(e,$),i=e[$];try{e[$]=void 0;var r=!0}catch{}var s=Ve.call(e);return r&&(t?e[$]=i:delete e[$]),s}var ze=Le,Be=Object.prototype,Ke=Be.toString;function Ue(e){return Ke.call(e)}var Ye=Ue,K=ae,Xe=ze,Ge=Ye,qe="[object Null]",Qe="[object Undefined]",U=K?K.toStringTag:void 0;function Ze(e){return e==null?e===void 0?Qe:qe:U&&U in Object(e)?Xe(e):Ge(e)}var Je=Ze;function et(e){return e!=null&&typeof e=="object"}var tt=et,it=Je,st=tt,rt="[object Symbol]";function nt(e){return typeof e=="symbol"||st(e)&&it(e)==rt}var lt=nt,ot=We,Y=L,at=lt,X=NaN,ht=/^[-+]0x[0-9a-f]+$/i,ct=/^0b[01]+$/i,dt=/^0o[0-7]+$/i,ut=parseInt;function ft(e){if(typeof e=="number")return e;if(at(e))return X;if(Y(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Y(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ot(e);var i=ct.test(e);return i||dt.test(e)?ut(e.slice(2),i?2:8):ht.test(e)?X:+e}var pt=ft,gt=L,P=De,G=pt,mt="Expected a function",bt=Math.max,Tt=Math.min;function yt(e,t,i){var r,s,l,o,n,a,h=0,c=!1,f=!1,m=!0;if(typeof e!="function")throw new TypeError(mt);t=G(t)||0,gt(i)&&(c=!!i.leading,f="maxWait"in i,l=f?bt(G(i.maxWait)||0,t):l,m="trailing"in i?!!i.trailing:m);function d(u){var y=r,x=s;return r=s=void 0,h=u,o=e.apply(x,y),o}function T(u){return h=u,n=setTimeout(p,t),c?d(u):o}function v(u){var y=u-a,x=u-h,z=t-y;return f?Tt(z,l-x):z}function b(u){var y=u-a,x=u-h;return a===void 0||y>=t||y<0||f&&x>=l}function p(){var u=P();if(b(u))return w(u);n=setTimeout(p,v(u))}function w(u){return n=void 0,m&&r?d(u):(r=s=void 0,o)}function E(){n!==void 0&&clearTimeout(n),h=0,r=a=s=n=void 0}function ye(){return n===void 0?o:w(P())}function O(){var u=P(),y=b(u);if(r=arguments,s=this,a=u,y){if(n===void 0)return T(a);if(f)return clearTimeout(n),n=setTimeout(p,t),d(a)}return n===void 0&&(n=setTimeout(p,t)),o}return O.cancel=E,O.flush=ye,O}var St=yt,vt=St,wt=L,xt="Expected a function";function $t(e,t,i){var r=!0,s=!0;if(typeof e!="function")throw new TypeError(xt);return wt(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),vt(e,t,{leading:r,maxWait:t,trailing:s})}var Et=$t;const ce=le(Et);var q=!1,S,F,M,R,C,de,D,N,W,H,ue,I,j,fe,pe;function g(){if(!q){q=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),i=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(I=/\b(iPhone|iP[ao]d)/.exec(e),j=/\b(iP[ao]d)/.exec(e),H=/Android/i.exec(e),fe=/FBAN\/\w+;/i.exec(e),pe=/Mobile/i.exec(e),ue=!!/Win64/.exec(e),t){S=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN,S&&document&&document.documentMode&&(S=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(e);de=r?parseFloat(r[1])+4:S,F=t[2]?parseFloat(t[2]):NaN,M=t[3]?parseFloat(t[3]):NaN,R=t[4]?parseFloat(t[4]):NaN,R?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),C=t&&t[1]?parseFloat(t[1]):NaN):C=NaN}else S=F=M=C=R=NaN;if(i){if(i[1]){var s=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);D=s?parseFloat(s[1].replace("_",".")):!0}else D=!1;N=!!i[2],W=!!i[3]}else D=N=W=!1}}var V={ie:function(){return g()||S},ieCompatibilityMode:function(){return g()||de>S},ie64:function(){return V.ie()&&ue},firefox:function(){return g()||F},opera:function(){return g()||M},webkit:function(){return g()||R},safari:function(){return V.webkit()},chrome:function(){return g()||C},windows:function(){return g()||N},osx:function(){return g()||D},linux:function(){return g()||W},iphone:function(){return g()||I},mobile:function(){return g()||I||j||H||pe},nativeApp:function(){return g()||fe},android:function(){return g()||H},ipad:function(){return g()||j}},_t=V,k=!!(typeof window<"u"&&window.document&&window.document.createElement),kt={canUseDOM:k,canUseWorkers:typeof Worker<"u",canUseEventListeners:k&&!!(window.addEventListener||window.attachEvent),canUseViewport:k&&!!window.screen,isInWorker:!k},Rt=kt,ge=Rt,me;ge.canUseDOM&&(me=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function Ct(e,t){if(!ge.canUseDOM||t&&!("addEventListener"in document))return!1;var i="on"+e,r=i in document;if(!r){var s=document.createElement("div");s.setAttribute(i,"return;"),r=typeof s[i]=="function"}return!r&&me&&e==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var Dt=Ct,Ot=_t,Pt=Dt,Q=10,Z=40,J=800;function be(e){var t=0,i=0,r=0,s=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=i,i=0),r=t*Q,s=i*Q,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||s)&&e.deltaMode&&(e.deltaMode==1?(r*=Z,s*=Z):(r*=J,s*=J)),r&&!t&&(t=r<1?-1:1),s&&!i&&(i=s<1?-1:1),{spinX:t,spinY:i,pixelX:r,pixelY:s}}be.getEventType=function(){return Ot.firefox()?"DOMMouseScroll":Pt("wheel")?"wheel":"mousewheel"};var At=be,Ft=At;const Mt=le(Ft);typeof/./!="function"&&typeof Int8Array!="object"&&(Se.prototype.$isServer||document.childNodes);const ee=function(e,t){t=t||"";const i=t.split(".");let r=e,s=null;for(let l=0,o=i.length;l<o;l++){const n=i[l];if(!r)break;if(l===o-1){s=r[n];break}r=r[n]}return s};function Te(e){const t=window.getComputedStyle(e,null),i=["auto","scroll"];return i.includes(t.overflow)||i.includes(t["overflow-y"])}function Nt(e){let t=e;for(;t;){if([window,document,document.documentElement].includes(t))return window;if(Te(t))return t;t=t.parentNode}return t||window}function A(e){return e===window?window.pageYOffset:e.scrollTop}function Wt(e){return e===window?window.innerHeight:e.offsetHeight}function Ht(e,t){e===window?window.scroll(0,t):e.scrollTop=t}function te(e){return typeof e>"u"||e===null}const ie=typeof navigator<"u"&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1;function It(e,t){function i(s){const l=Mt(s);if(Math.abs(l.spinY)>0){const o=e.scrollTop;l.pixelY<0&&o!==0&&s.preventDefault(),l.pixelY>0&&e.scrollHeight-e.clientHeight>o&&s.preventDefault(),e.scrollTop+=Math.ceil(l.pixelY/t)}}const r=ce(i,0);return e.addEventListener(ie?"DOMMouseScroll":"mousewheel",r,{passive:!1}),function(){e.removeEventListener(ie?"DOMMouseScroll":"mousewheel",r)}}const se=function(e){return e!==null&&typeof e=="object"},jt=function(e,t,i,r,s){if(!t&&!r&&(!s||Array.isArray(s)&&!s.length))return e;typeof i=="string"?i=i==="descending"?-1:1:i=i&&i<0?-1:1;const l=r?null:function(n,a){return s?(Array.isArray(s)||(s=[s]),s.map(function(h){return typeof h=="string"?ee(n,h):h(n,a,e)})):(t!=="$key"&&se(n)&&"$value"in n&&(n=n.$value),[se(n)?ee(n,t):n])},o=function(n,a){if(r)return r(n.value,a.value);for(let h=0,c=n.key.length;h<c;h++){if(n.key[h]<a.key[h])return-1;if(n.key[h]>a.key[h])return 1}return 0};return e.map(function(n,a){return{value:n,index:a,key:l?l(n,a):null}}).sort(function(n,a){let h=o(n,a);return h||(h=n.index-a.index),h*i}).map(n=>n.value)},Vt=function(e,t){let i=null;return e.columns.forEach(function(r){r.id===t&&(i=r)}),i};var Lt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el-table-virtual-scroll",class:[e.isExpanding?"is-expanding":"",e.isHideAppend?"hide-append":"",e.scrollPosition?"is-scrolling-"+e.scrollPosition:"",e.hasFixedRight?"has-custom-fixed-right":""]},[e._t("default",null,null,{headerCellFixedStyle:e.headerCellFixedStyle,cellFixedStyle:e.cellFixedStyle})],2)},zt=[];const re=[".el-table__body-wrapper",".el-table__fixed-right .el-table__fixed-body-wrapper",".el-table__fixed .el-table__fixed-body-wrapper"],Bt={name:"el-table-virtual-scroll",props:{data:{type:Array,required:!0},itemSize:{type:Number,default:60},scrollBox:{type:String},buffer:{type:Number,default:200},keyProp:{type:String,default:"id"},throttleTime:{type:Number,default:16},dynamic:{type:Boolean,default:!0},virtualized:{type:Boolean,default:!0},rowSpanKey:{type:Function},warn:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},selectionSort:{type:[Function,Boolean],default:!0},getElTable:{type:Function,default:function(){return this.$children[0]}},keepScroll:{type:Boolean,default:!0}},provide(){return{virtualScroll:this}},data(){return{sizes:{},start:0,end:void 0,curRow:null,oldSelection:[],isExpanding:!1,columnVms:[],isHideAppend:!1,scrollPosition:"",hasFixedRight:!1,listData:[],isTree:!1}},computed:{offsetMap({keyProp:e,itemSize:t,sizes:i,listData:r}){if(!this.dynamic)return{};const s={};let l=0;for(let o=0;o<r.length;o++){const n=r[o][e];typeof n>"u"&&this.warn&&console.warn(`data[${o}][${e}] 为 undefined，请确保 keyProp 对应的值不为undefined`),s[n]=l;const a=i[n];l+=typeof a=="number"?a:t}return s},treeMap({data:e,keyProp:t,treeProps:i,isTree:r}){if(!r||!i)return;const s={},{children:l}=i,o=n=>{n.forEach(a=>{const h=a[t];typeof h<"u"&&a[l]&&(s[h]=a[l],o(a[l]))})};return o(e),s}},methods:{initData(){if(this.destory(),this.renderData=[],this.top=void 0,this.bottom=void 0,this.start=0,this.end=void 0,this.isInnerScroll=!1,this.highlightRow=null,this.scrollPos=[0,0],this.triggleScroll=!1,this.checkOrder=0,this.elTable=this.getElTable(),!this.elTable||this.elTable.$options.name!=="ElTable")throw new Error("未找到 <el-table> 组件. 请确保 <el-table> 组件在虚拟组件内，且 getElTable 方法能获取到正确的 <el-table> 组件！");this.elTable.rowKey||this.warn&&console.warn("[el-table-virtual-scroll]: 建议设置 <el-table> 组件的 rowKey 属性"),this.scroller=this.getScroller(),this.observeElTable(),this.onScroll=this.throttleTime?ce(this.handleScroll,this.throttleTime):this.handleScroll,this.scroller.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.onScroll),this.hackTableExpand(),this.hackTableHeaderDrag(),this.hackTableSort(),this.hackTableFilter(),this.hackRowHighlight(),this.hackSelection(),this.hackCustomTree(),this.bindTableDestory(),this.treeProps=this.elTable.treeProps||{children:"children",hasChildren:"hasChildren"},this.elTable.defaultSort?this.$nextTick(()=>{this.onSortChange()}):this.updateTreeData(),setTimeout(()=>{!this.triggleScroll&&this.onScroll()},100)},slowOnMousewheel(e=1,t=this.scroller){this.removeMousewheelEvent&&this.removeMousewheelEvent(),this.removeMousewheelEvent=null,e&&(this.removeMousewheelEvent=It(t,e))},getScroller(){let e;if(this.scrollBox){if(this.scrollBox==="window"||this.scrollBox===window)return window;if(e=document.querySelector(this.scrollBox),!e)throw new Error(` scrollBox prop: '${this.scrollBox}' is not a valid selector`);return Te(e)||console.warn(`Warning! scrollBox prop: '${this.scrollBox}' is not a scroll element`),e}return this.elTable&&(this.elTable.height||this.elTable.maxHeight||this.elTable.height===0||this.elTable.maxHeight===0)?(this.isInnerScroll=!0,this.$el.querySelector(".el-table__body-wrapper")):Nt(this.$el)},getToTop(){return this.isInnerScroll?0:this.$el.getBoundingClientRect().top-(this.scroller===window?0:this.scroller.getBoundingClientRect().top)+A(this.scroller)},handleScroll(e=!0){this.disabled||this.scroller&&(this.triggleScroll=!0,!(this.isInnerScroll&&!this.scroller.style.height&&!this.scroller.style.maxHeight)&&(this.isDeactivated||(this.isInnerScroll&&this.elTable.layout.bodyHeight&&(this.scrollPos[0]=this.scroller.scrollTop,this.scrollPos[1]=this.scroller.scrollLeft),this.virtualized&&(this.removeHoverRows(),this.updateSizes(),this.calcRenderData(),this.calcPosition(),e&&this.updatePosition(),this.$emit("change",this.renderData,this.start,this.end),this.syncRowsHighlight()))))},removeHoverRows(){const e=this.$el.querySelectorAll(".el-table__row.hover-row");e.length>1&&Array.from(e).forEach(t=>{t.classList.remove("hover-row")})},updateSizes(){if(!this.dynamic)return;let e=this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row");const t=this.elTable.lazy,i=this.isTree,r=/el-table__row--level-[1-9]\d*/;!i&&t&&(e=Array.from(this.$el.querySelectorAll(".el-table__body > tbody > .el-table__row")).filter(s=>!r.test(s.className))),Array.from(e).forEach((s,l)=>{const o=this.renderData[l];if(!o)return;let n=s.offsetHeight;if(!t&&!i&&s.classList.contains("expanded")&&(n+=s.nextSibling.offsetHeight),t){let h=s.nextSibling;for(;h&&h.tagName==="TR"&&r.test(h.className);)n+=h.offsetHeight,h=h.nextSibling}const a=o[this.keyProp];n&&this.sizes[a]!==n&&this.$set(this.sizes,a,n)})},getItemOffsetTop(e){if(!this.dynamic)return this.itemSize*e;const t=this.listData[e];return t&&this.offsetMap[t[this.keyProp]]||0},getItemSize(e){if(e<=-1)return 0;const t=this.listData[e];if(t){const i=t[this.keyProp];return this.sizes[i]||this.itemSize}return this.itemSize},calcRenderData(){const{scroller:e,listData:t,buffer:i}=this,r=this.getToTop(),s=A(e)-i-r,l=A(e)+Wt(e)+i-r;let o,n;if(!this.dynamic)o=s<=0?0:Math.floor(s/this.itemSize),n=l<=0?0:Math.ceil(l/this.itemSize);else{let a=0,h=t.length-1,c=0;for(;a<=h;)if(c=Math.floor((a+h)/2),this.getItemOffsetTop(c)<s){if(this.getItemOffsetTop(c+1)>s)break;a=c+1}else h=c-1;for(o=c,a=o,h=t.length-1,c=0;a<=h;)if(c=Math.floor((a+h)/2),this.getItemOffsetTop(c)>=l){if(this.getItemOffsetTop(c-1)<l)break;h=c-1}else a=c+1;n=c}this.isRowSpan()?[o,n]=this.calcRenderSpanData(o,n):o%2&&(o=o-1),this.top=s,this.bottom=l,this.start=o,this.end=n,this.renderData=t.slice(o,n+1),this.start===0&&this.end>30&&this.end===this.listData.length-1&&this.warn&&console.warn("[el-table-virtual-scroll] 表格数据全部渲染，渲染数量为:"+this.listData.length)},isRowSpan(){return typeof this.rowSpanKey=="function"},calcRenderSpanData(e,t){let i;for(;e>0;){const s=this.listData[e],l=this.rowSpanKey(s,e);if(te(l))break;if(!te(i)&&i!==l){e++;break}i=l,e--}const r=this.listData.length;for(i=void 0;t<r;){const s=this.listData[t],l=this.rowSpanKey(s,t);if(!l)break;if(i&&i!==l){t--;break}i=l,t++}return[e,t]},calcPosition(){const e=this.listData.length-1,t=this.getItemOffsetTop(e)+this.getItemSize(e),i=this.getItemOffsetTop(this.start);let r;re.forEach((s,l)=>{const o=this.$el.querySelector(s);if(o){if(!o.wrapEl){const n=document.createElement("div"),a=document.createElement("div");n.appendChild(a),a.appendChild(o.children[0]),o.insertBefore(n,o.firstChild),o.wrapEl=n,o.innerEl=a,l>0&&r&&this.$nextTick(()=>{o.scrollTop=r.scrollTop})}l===0&&(r=o),o.wrapEl&&(o.wrapEl.style.height=t+"px",o.innerEl.style.transform=`translateY(${i}px)`)}})},observeElTable(){const e=this.$watch(()=>[this.elTable.scrollPosition,this.elTable.layout.scrollX],([i,r],[s,l]=[])=>{this.scrollPosition=this.elTable.layout.scrollX?i:"none",r&&!l&&this.elTable.syncPostion&&this.elTable.syncPostion()},{immediate:!0}),t=this.$watch(()=>this.elTable.layout.bodyHeight,i=>{i>0&&this.restoreScroll(),i>0&&this.onScroll()});this.unWatchs=[e,t]},doUpdate(){this.hasDoUpdate||this.scroller&&(this.isHideAppend=!0,this.onScroll(),this.hasDoUpdate=!0,this.$nextTick(()=>{this.hasDoUpdate=!1,this.isHideAppend=!1}))},updatePosition(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.timer&&clearTimeout(this.timer),this.handleScroll(!1)},this.throttleTime+10)},renderAllData(){this.renderData=this.listData,this.$emit("change",this.listData,0,this.listData.length-1),console.log("renderAllData",this.listData),this.$nextTick(()=>{re.forEach(e=>{const t=this.$el.querySelector(e);t&&t.wrapEl&&(t.wrapEl.style.height="auto",t.innerEl.style.transform="translateY(0px)")})})},restoreScroll(){!this.scroller||!this.isInnerScroll||(this.scroller.scrollLeft=this.keepScroll?this.scrollPos[1]:0,this.scroller.scrollTop=this.keepScroll?this.scrollPos[0]:0)},update(){this.isTree&&this.onFilterChange&&this.onFilterChange(),this.handleScroll()},scrollTo(e,t=0,i=!1){this.listData[e]&&this.scroller&&(this.updateSizes(),this.calcRenderData(),this.$nextTick(()=>{const s=this.getItemOffsetTop(e)-t;Ht(this.scroller,s),i||setTimeout(()=>{this.scrollTo(e,t,!0)},50)}))},scrollToRow(e,t=0){const i=this.listData.findIndex(r=>r===e||r[this.keyProp]===e[this.keyProp]);this.scrollTo(i,t)},reset(){this.sizes={},this.scrollTo(0,0,!1)},destory(){this.scroller&&(this.scroller.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onScroll)),this.unWatchs&&this.unWatchs.forEach(e=>e()),this.removeMousewheelEvent&&this.removeMousewheelEvent(),this.oldSelection=[],this.elTable=null,this.scroller=null,this.unWatchs=[]},getData(e=!0){return this.list||(e?this.data:this.listData)},addColumn(e){this.columnVms.push(e)},removeColumn(e){this.columnVms=this.columnVms.filter(t=>t!==e)},checkAll(e,t=this.listData,i=!1){const r=[];t.forEach(l=>{l.$v_checked&&r.push(l),l.$v_checked!==e&&(this.$set(l,"$v_checked",e),this.$set(l,"$v_checkedOrder",e?this.checkOrder++:void 0))});const s=this.emitSelectionChange(r);i&&(this.$emit("select-all",s,e),this.elTable.$emit("select-all",s,e)),e===!1&&(this.checkOrder=0)},checkRow(e,t,i=!0,r=!1){if(e.$v_checked!==t&&(this.$set(e,"$v_checked",t),this.$set(e,"$v_checkedOrder",t?this.checkOrder++:void 0),i)){const s=this.emitSelectionChange(t?[]:[e]);r&&(this.$emit("select",s,e,t),this.elTable.$emit("select",s,e,t))}},clearSelection(){this.oldSelection.forEach(e=>{this.$set(e,"$v_checked",!1)}),this.oldSelection=[],this.checkAll(!1),this.columnVms.forEach(e=>e.syncCheckStatus())},toggleRowSelection(e,t){Array.isArray(e)||(e=[e]),this.toggleRowsSelection(e,t)},toggleRowsSelection(e,t){const i={},r={};let s=null;const l=this.isReserveSelection();l&&(this.oldSelection.forEach(n=>{i[n[this.keyProp]]=!0}),this.data.forEach(n=>{r[n[this.keyProp]]=!0}));const o=[];e.forEach(n=>{const a=typeof t=="boolean"?t:!n.$v_checked;if(!a&&o.push(n),this.$set(n,"$v_checked",a),this.$set(n,"$v_checkedOrder",a?this.checkOrder++:void 0),!l)return;const h=n[this.keyProp];h in i&&!a&&(s||(s={}),s[h]=!0),!(h in r)&&a&&this.oldSelection.push(n)}),s&&(this.oldSelection=this.oldSelection.filter(n=>!(n[this.keyProp]in s))),this.emitSelectionChange(o),this.columnVms.forEach(n=>n.syncCheckStatus())},emitSelectionChange(e){const t=this.isReserveSelection(),i=t?[...this.oldSelection]:[];return this.data.forEach(r=>{r.$v_checked&&i.push(r)}),this.sortSelection(i),this.$emit("selection-change",i,e),this.elTable.$emit("selection-change",i,e),t||(this.oldSelection=[...i]),i},updateSelectionByRowKey(e,t=[]){if(!this.elTable)return;t.forEach(s=>{s.$v_checked&&this.oldSelection.push(s)});const i={};this.oldSelection.forEach(s=>{i[s[this.keyProp]]=!0});const r={};e.forEach(s=>{const l=s[this.keyProp];l in i&&(this.$set(s,"$v_checked",!0),r[l]=!0)}),this.oldSelection=this.oldSelection.filter(s=>!(s[this.keyProp]in r))},isReserveSelection(){return this.columnVms.some(e=>e.reserveSelection&&e.isSelection())},getSelection(){if(this.isReserveSelection()){const e=this.data.filter(t=>t.$v_checked);return[...this.oldSelection,...e]}else return this.oldSelection},updateSelectionData(e,t){if(this.syncSelectionStatus(),e!==t){this.oldSelection.length>0&&(this.$emit("selection-change",[],[...this.oldSelection]),this.elTable.$emit("selection-change",[],[...this.oldSelection]),this.oldSelection=[]);return}const i=this.data.filter(l=>l.$v_checked);this.sortSelection(i);const r=i.reduce((l,o)=>(l[o[this.keyProp]]=!0,l),{}),s=this.oldSelection.reduce((l,o)=>(o[this.keyProp]in r||l.push(o),l),[]);(s.length||i.length!==this.oldSelection.length)&&(this.$emit("selection-change",i,s),this.elTable.$emit("selection-change",i,s),this.oldSelection=[...i])},sortSelection(e){this.selectionSort&&(typeof this.selectionSort=="function"?e.sort((t,i)=>this.selectionSort(t,i)):e.sort((t,i)=>t.$v_checkedOrder-i.$v_checkedOrder))},syncSelectionStatus(){const e=this.columnVms.find(t=>t.isSelection());e&&e.syncCheckStatus()},setCurrentRow(e){this.curRow=e,this.$emit("current-change",e),this.elTable.$emit("current-change",e)},hackRowHighlight(){if(this.elTable.setCurrentRow.virtual){const i=this.elTable.setCurrentRow.bind(this.elTable),r=s=>{this.elTable.store.states.currentRow=this.highlightRow,this.highlightRow!==s&&(this.highlightRow=s),i(s)};this.elTable.setCurrentRow=r,r.virtual=!0}const e=this.$watch(()=>this.elTable.currentRowKey,i=>{if(this.elTable.rowKey){const r=this.listData.find(s=>i===s[this.elTable.rowKey]);this.highlightRow=r}},{immediate:!0});this.unWatchs.push(e);const t=i=>{this.highlightRow=i};this.elTable.$on("current-change",t),this.unWatchs.push(()=>{this.elTable.$off("current-change",t)})},syncRowsHighlight(){this.elTable.highlightCurrentRow&&this.$nextTick(()=>{this.elTable.store.states.currentRow=this.highlightRow})},useCustomSelection(){this.isSelection=!0},hackSelection(){const e=()=>{if(!this.elTable)return;this.elTable.$children.filter(r=>r.$options.name==="ElTableBody").forEach(r=>{if(r.getRowClass.virtual)return;const s=r.getRowClass.bind(this.elTable);r.getRowClass=(l,o)=>{const n=s(l,o);return this.elTable.highlightSelectionRow&&l.$v_checked&&n.push("selection-row"),n},r.getRowClass.virtual=!0})},t=this.$watch(()=>[this.elTable.fixedColumns,this.elTable.rightFixedColumns],e,{immediate:!0});this.unWatchs.push(t),this.elTable.toggleRowSelection=(i,r)=>{this.toggleRowSelection(i,r)},this.elTable.clearSelection=()=>{this.clearSelection()},this.elTable.toggleAllSelection=()=>{const i=this.columnVms.find(r=>r.isSelection());i&&i.onCheckAllRows(!i.isCheckedAll)}},hackTableHeaderDrag(){const e=()=>{this.hasHeadDrag=!0,setTimeout(()=>{this.elTable.doLayout()}),this.update()};this.elTable.$on("header-dragend",e),this.unWatchs.push(()=>{this.elTable.$off("header-dragend",e)})},useExpandTable(){this.isExpandType=!0},hackTableExpand(){if(!this.isExpandType)return;const{store:e}=this.elTable;e.isRowExpanded=t=>t.$v_expanded,e.setExpandRowKeys=()=>{const{expandRowKeys:t}=this.elTable;this.listData.forEach(i=>{this.$set(i,"$v_expanded",t.includes(i[this.elTable.rowKey]))})},e.updateExpandRows=()=>{const{defaultExpandAll:t}=this.elTable;t&&this.listData.forEach(i=>{this.$set(i,"$v_expanded",!0)})},e.toggleRowExpansion=(t,i)=>{const r=typeof i=="boolean"?i:!t.$v_expanded;r!==!!t.$v_expanded&&(this.$set(t,"$v_expanded",r),this.elTable.$emit("expand-change",t,this.listData.filter(s=>s.$v_expanded)),!this.updateExpandeding&&(this.updateExpandeding=!0,this.$nextTick(()=>{this.updateExpandeding=!1,this.update()})))},e.states.expandRows.indexOf=t=>t&&t.$v_expanded||-1},toggleRowExpansion(e,t){this.elTable.toggleRowExpansion(e,t)},headerCellFixedStyle(e){return this.cellFixedStyle(e,!0)},cellFixedStyle({column:e},t=!1){const i=this.getElTable();if(!i)return;const{gutterWidth:r,scrollY:s,bodyWidth:l}=i.layout,o=t&&s?r:0;if(!this.fixedMap||this._isScrollY!==s||this._bodyWidth!==l||this.hasHeadDrag){this.hasHeadDrag&&(this.hasHeadDrag=!1),this._isScrollY=s,this._bodyWidth=l,this.fixedMap={},this.totalLeft=0,this.totalRight=0;const c=i.columns,f=[];let m,d;for(let b=0;b<c.length;b++){const p=c[b],w=p.className&&p.className.includes("virtual-column__fixed-left"),E=p.className&&p.className.includes("virtual-column__fixed-right");!w&&!E||(w&&(m=p,this.fixedMap[p.id]={left:this.totalLeft},this.totalLeft+=p.realWidth||p.width),E&&(d||(d=p),f.push(p)))}const T=" is-last-column",v=" is-first-column";m&&!m.className.includes(T)&&(m.className+=T),d&&!d.className.includes(v)&&(d.className+=v),this.hasFixedRight=f.length>0,f.reverse().forEach(b=>{this.fixedMap[b.id]={right:this.totalRight},this.totalRight+=b.realWidth||b.width})}const n=this.fixedMap[e.id];if(!n)return;const h="right"in n?{right:n.right+o+"px"}:{left:n.left+"px"};return i.showSummary&&this.$nextTick(()=>{const c=this.$el.querySelector(`.el-table__footer-wrapper .${e.id}`);c&&(h.left&&(c.style.left=h.left),h.right&&(c.style.right=h.right))}),h},doHeaderLayout(){this.elTable&&(this.fixedMap=null,this.elTable.$refs.tableHeader.$forceUpdate())},hackTableSort(){this.onSortChange=()=>{if(!this.elTable)return;const t=this.elTable.store.states,{sortingColumn:i}=t,r=this.filterData||this.data;if(!i||typeof i.sortable=="string")this.updateTreeData(r);else{const s=jt(r,t.sortProp,t.sortOrder,i.sortMethod,i.sortBy);this.updateTreeData(s)}this.doUpdate(),this.virtualized||this.renderAllData(),this.$nextTick(()=>{this.syncSelectionStatus()})},this.elTable.$on("sort-change",this.onSortChange),this.unWatchs.push(()=>{this.elTable.$off("sort-change",this.onSortChange)});const e=this.elTable.clearSort.bind(this.elTable);this.elTable.clearSort=(...t)=>{e(...t),this.onSortChange()}},hackTableFilter(){this.isTree&&this.$nextTick(()=>{this.elTable.store.execQuery=()=>{this.elTable.store.states.data=[...this.elTable.data]}}),this.onFilterChange=()=>{if(!this.elTable)return;const i=this.elTable.store.states,{filters:r}=i;let s=this.data;Object.keys(r).forEach(o=>{const n=i.filters[o];if(!n||n.length===0)return;const a=Vt(i,o);a&&a.filterMethod&&(s=s.filter(h=>n.some(c=>a.filterMethod.call(null,c,h,a))))});const l=this.data!==s;this.filterData=l?s:null,this.onSortChange()},this.elTable.$on("filter-change",this.onFilterChange),this.unWatchs.push(()=>{this.elTable.$off("filter-change",this.onFilterChange)});const e=this.elTable.clearFilter.bind(this.elTable);this.elTable.clearFilter=(...i)=>{e(...i),this.onFilterChange()},this.elTable.store.states.columns.forEach(i=>{i.filteredValue&&i.filteredValue.length&&this.onFilterChange()})},useCustomTree(e=!0){this.isTree=!0;const t=this.getElTable();if(t){const i=t.store.states;i.childrenColumnName="",i.lazyColumnIdentifier="",t.store.updateTreeData=()=>{}}else e&&this.$nextTick(()=>{this.useCustomTree(!1)})},hackCustomTree(){if(!this.isTree)return;const e=this.$watch(()=>this.elTable.expandRowKeys,()=>{this.expandRowKeysChanged=!0,this.update(),this.expandRowKeysChanged=!1});this.unWatchs.push(e),this.elTable.toggleRowExpansion=(t,i)=>{const r=t.$v_tree;r&&(typeof i>"u"&&(i=!r.expanded),r.expanded!==i&&(r.expanded=i,!this.togglingRowExpansion&&(this.togglingRowExpansion=!0,this.$nextTick(()=>{this.togglingRowExpansion=!1,this.update(),this.columnVms.forEach(s=>s.isTree&&s.renderTreeNode())}))))}},updateTreeData(e=this.data){if(!this.isTree||!this.treeProps){this.listData=e;return}const t=[],{children:i="children"}=this.treeProps,{defaultExpandAll:r,expandRowKeys:s,rowKey:l,indent:o}=this.elTable,n=h=>h&&(r||s&&s.indexOf(h)!==-1)||!1,a=(h,c,f=0,m=!0)=>{h.forEach(d=>{m&&t.push(d);let T=d.$v_tree||{};if(d.$v_tree?this.expandRowKeysChanged&&(T.expanded=n(d[l])):d.$v_tree=T={parent:c,level:f,expanded:n(d[l]),loaded:!1,loading:!1,indent:(f-1)*o},Array.isArray(d[i])){const v=m&&T.expanded;a(d[i],d,f+1,v)}})};a(e),this.listData=t},getChildNodes(e){const{children:t="children"}=this.treeProps;return e[t]||[]},getParentNode(e){const t=e.$v_tree;return t&&t.parent},getParentNodes(e){const t=[];let i=e;for(;i;){const r=i.$v_tree;if(!r||!r.parent)break;t.unshift(r.parent),i=r.parent}return t},async reloadNode(e){const t=e.$v_tree;if(!t)return;const{children:i="children",hasChildren:r="hasChildren"}=this.treeProps;e[i]=null,e[r]=!0,t.loaded=!1,this.update();const s=this.columnVms.find(l=>l.isTree);s&&await s.loadChildNodes(e,!0)},unexpandAllNodes(){const{children:e}=this.treeProps,t=i=>{i.forEach(r=>{this.toggleRowExpansion(r,!1),Array.isArray(r[e])&&t(r[e])})};t(this.listData)},expandAllNodes(){const{children:e,hasChildren:t="hasChildren"}=this.treeProps,i=r=>{r.forEach(s=>{const l=s.$v_tree;s[t]&&!l.loaded||(this.toggleRowExpansion(s,!0),Array.isArray(s[e])&&i(s[e]))})};i(this.listData)},bindTableDestory(){const e=()=>{this.warn&&console.warn("<el-table> 组件销毁时，建议将 <el-table-virtual-scroll> 组件一同销毁"),this.destory(),this.$nextTick(()=>{this.initData()})};this.elTable.$on("hook:beforeDestory",e),this.unWatchs.push(()=>{this.elTable.$off("hook:beforeDestory",e)})}},watch:{data(e,t){this.listData=e,this.list&&e!==t&&(this.list=e),this.onFilterChange&&this.onFilterChange(),this.isReserveSelection()?this.updateSelectionByRowKey(e,t):this.updateSelectionData(e,t)},virtualized:{immediate:!0,handler(){this.onFilterChange&&this.onFilterChange()}},disabled(){this.doUpdate()},treeMap(){this.update()}},created(){this.$nextTick(()=>{this.initData()})},activated(){var e;this.isDeactivated=!1,((e=this.elTable)==null?void 0:e.fit)===!1&&this.restoreScroll()},deactivated(){this.isDeactivated=!0},beforeDestroy(){this.destory()}},ne={};var Kt=ve(Bt,Lt,zt,!1,Ut,"5c49d3c9");function Ut(e){for(let t in ne)this[t]=ne[t]}const Xt=function(){return Kt.exports}();export{Xt as V};
//# sourceMappingURL=el-table-virtual-column.vue_vue_type_style_index_0_lang-DWl8J-iF.js.map
