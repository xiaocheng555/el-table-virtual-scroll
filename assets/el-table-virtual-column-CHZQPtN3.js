import{n as h,e as c}from"./index-DdXaGUey.js";import"./el-table-virtual-column.vue_vue_type_style_index_0_lang-BUcgPw7q.js";const f={name:"el-table-virtual-column-formatter",props:{vNode:{type:Object}},render(){return this.vNode}};let m,_;const u={};var v=h(f,m,_,!1,p,null);function p(e){for(let l in u)this[l]=u[l]}const C=function(){return v.exports}();var b=function(){var e=this,l=e.$createElement,r=e._self._c||l;return r("el-table-column",e._g(e._b({attrs:{type:e.getColumnType(),"class-name":e.getClassName},scopedSlots:e._u([{key:"header",fn:function(t){return[e.$scopedSlots.header?e._t("header",null,null,t):[e.$attrs.type==="selection"?r("el-checkbox",{attrs:{value:e.isCheckedAll,indeterminate:e.isCheckedImn},on:{change:e.onCheckAllRows}}):[e._v(" "+e._s(t.column.label)+" ")]]]}},{key:"default",fn:function(t){return[e.isTree?[r("span",{staticClass:"el-table__indent",style:{paddingLeft:e.getTreeState(t.row).level*e.indent+"px"}}),e.canExpand(t.row)&&e.treeNodeKey?r("div",{staticClass:"el-table__expand-icon",class:e.getTreeState(t.row).expanded?"el-table__expand-icon--expanded":"",on:{click:function(s){return e.onTreeNodeExpand(t.row)}}},[e.getTreeState(t.row).loading?r("i",{staticClass:"el-icon-loading"}):r("i",{staticClass:"el-icon-arrow-right"})]):r("span",{staticClass:"el-table__placeholder"})]:e._e(),e.$scopedSlots.default?e._t("default",null,null,e.setScope(t)):[e.$attrs.type==="selection"?r("el-checkbox",{attrs:{value:t.row.$v_checked||!1,disabled:e.getDisabled(t)},on:{change:function(s){return e.onCheckRow(t,!t.row.$v_checked)}},nativeOn:{click:function(s){s.stopPropagation()}}}):e._e(),e.$attrs.type==="radio"?r("el-radio",{attrs:{label:!0,value:e.virtualScroll.curRow===t.row},on:{change:function(s){return e.onRadioChange(t.row)}}},[r("span")]):e.$attrs.type==="index"?r("span",[e._v(" "+e._s(e.getIndex(t))+" ")]):t.column.formatter?[e.isVNode(e.getFormatterResult(t))?r("el-table-virtual-column-formatter",{attrs:{"v-node":e.getFormatterResult(t)}}):[e._v(e._s(e.getFormatterResult(t)))]]:[e._v(" "+e._s(t.row[t.column.property])+" ")]]]}}],null,!0)},"el-table-column",e.$attrs,!1),e.$listeners),[e.isNested?[e._t("default")]:e._e()],2)},S=[];const i={scope:null,result:null},x={name:"el-table-virtual-column",components:{ElCheckbox:c.Checkbox,ElRadio:c.Radio,ElTableVirtualColumnFormatter:C},inject:["virtualScroll"],props:{selectable:{type:Function},reserveSelection:{type:Boolean,default:!1}},data(){return{isCheckedAll:!1,isCheckedImn:!1,isTree:!1,isNested:!1,treeNodeKey:1}},computed:{getClassName(){const e=[],l=this.$attrs["class-name"]||this.$attrs.className;l&&e.push(l),this.isTree&&e.push("el-table__row--level");let r=this.$attrs.vfixed;return(r===!0||r==="")&&(r="left"),r&&e.push("virtual-column__fixed-"+r),e.join(" ")},indent(){return(this.virtualScroll.elTable||{}).indent||16}},methods:{getColumnType(){const{type:e}=this.$attrs;return["index","selection","radio","tree"].includes(e)?"":e},getDisabled(e){if(this.selectable){const l=this.getIndex(e,!1);return!this.selectable(e.row,l)}return!1},onCheckAllRows(e){const{selectOnIndeterminate:l=!0}=this.virtualScroll.elTable;if(l?e=this.isCheckedImn?!0:!this.isCheckedAll:e=this.isCheckedImn?!1:!this.isCheckedAll,this.selectable){const t=[];this.virtualScroll.getData(!1).forEach((n,a)=>{this.selectable(n,a)&&t.push(n)}),this.virtualScroll.checkAll(e,t,!0)}else this.virtualScroll.checkAll(e);const r=this.virtualScroll.getSelection();this.isCheckedImn=!e&&r.length>0,this.isCheckedAll=e},onCheckRow(e,l){const r=this.getIndex(e,!1);this.selectable&&!this.selectable(e.row,r)||(this.virtualScroll.checkRow(e.row,l,!0,!0),this.syncCheckStatus())},isSelection(){return this.$attrs.type==="selection"},syncCheckStatus(){const e=this.virtualScroll.getData(!1),l=e.filter(t=>t.$v_checked===!0).length,r=this.virtualScroll.getSelection();l&&l===e.length?this.isCheckedAll=!0:l&&this.selectable?this.isCheckedAll=e.every((t,s)=>this.selectable(t,s)?t.$v_checked:!0):this.isCheckedAll=!1,this.isCheckedImn=!this.isCheckedAll&&r.length>0},onRadioChange(e){this.virtualScroll.setCurrentRow(e)},getIndex(e,l=!0){const r=this.virtualScroll.start+e.$index;return typeof this.$attrs.index=="function"?this.$attrs.index(r):r+(l?1:0)},setScope(e){return e.$index=this.virtualScroll.start+e.$index,e},getTreeState(e){return e.$v_tree||{}},canExpand(e){const{children:l="children",hasChildren:r="hasChildren"}=this.virtualScroll.treeProps||{},t=e.$v_tree||{};return(e[l]||[]).length>0||e[r]&&!t.loaded},async onTreeNodeExpand(e){const l=e.$v_tree;if(l){const{treeProps:r}=this.virtualScroll,{hasChildren:t="hasChildren"}=r;if(l.loading)return;!l.expanded&&e[t]&&!l.loaded?await this.loadChildNodes(e):(l.expanded=!l.expanded,this.renderTreeNode(),this.virtualScroll.update()),this.virtualScroll.elTable.$emit("expand-change",e,l.expanded)}},async loadChildNodes(e){return new Promise(l=>{const{treeProps:r}=this.virtualScroll,{load:t}=this.virtualScroll.elTable;if(!t)return l();const{children:s="children"}=r,n=e.$v_tree;n.loading=!0,this.renderTreeNode();function a(o){if(!Array.isArray(o))throw new Error("[ElTable] data must be an array");if(n.loading=!1,n.loaded=!0,n.expanded=!0,this.renderTreeNode(),!Array.isArray(o)){l();return}this.$set(e,s,o),this.virtualScroll.update(),l()}t(e,n,a.bind(this))})},renderTreeNode(){this.treeNodeKey=this.treeNodeKey===1?2:1},isVNode(e){return this._vnode.constructor===(e==null?void 0:e.constructor)},getFormatterResult(e){return i.scope===e||(i.scope=e,i.result=e.column.formatter(e.row,e.column,e.row[e.column.property],e.$index)),i.result}},beforeCreate(){this.$root.$options.components.ElTableColumn||(this.$options.components.ElTableColumn=c.TableColumn)},created(){this.isNested=!!this.$slots.default,this.virtualScroll.addColumn(this);const{type:e}=this.$attrs;e==="expand"?this.virtualScroll.useExpandTable():e==="tree"?(this.isTree=!0,this.virtualScroll.useCustomTree()):e==="selection"&&this.virtualScroll.useCustomSelection()},beforeDestroy(){this.virtualScroll.removeColumn(this),i.scope=null,i.result=null}},d={};var g=h(x,b,S,!1,$,null);function $(e){for(let l in d)this[l]=d[l]}const T=function(){return g.exports}();export{T as V};
//# sourceMappingURL=el-table-virtual-column-CHZQPtN3.js.map
